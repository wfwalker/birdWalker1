<!-- <?xml-stylesheet type="text/xsl" href="build.xsl"?> -->

<project name="birding-xml" default="build-all">

	<!-- BUILDING SOURCES -->

	<target name="validate">
		<antstructure output="dtds/project.dtd"/>
		<xmlvalidate taskname="validate sightings" file="sightings.xml"/>
		<xmlvalidate taskname="validate locations" file="locations.xml"/>
		<xmlvalidate taskname="validate trips" file="flat-trips.xml"/>
		<xmlvalidate taskname="validate species" file="flat-species.xml"/>
	</target>
	
	<target
		name="compile">
		<javac
			srcdir="java/src"
			destdir="java/bin"/>
	</target>

	<target
		name="run-batch-transformer"
		depends="compile">
		<java
			fork="true"
			classname="BatchTransformer"
			classpath="java/bin;java/lib/xalan.jar;java/lib/xml-apis.jar"/>
	</target>

	<target
		name="build-sources"
		depends="validate"
		description="build three ant XML project files that will build the source xml files for trips">
	
		<style
			taskname="build-species-sources"
			style="transform-xsl/build-species-sources.xsl"
			in="flat-species.xml"
			out="build-species-sources.xml">
		</style>
		<ant taskname="create-species-sources" antfile="build-species-sources.xml"/>
	
		<style
			taskname="build-year-sources"
			style="transform-xsl/build-year-sources.xsl"
			in="misc.xml"
			out="build-year-sources.xml">
		</style>
		<ant taskname="create-year-sources" antfile="build-year-sources.xml"/>
	
		<style
			taskname="build-trip-sources"
			style="transform-xsl/build-trip-sources.xsl"
			in="flat-trips.xml"
			out="build-trip-sources.xml">
		</style>
		<ant taskname="create-trip-sources" antfile="build-trip-sources.xml"/>
	
		<style
			taskname="build-location-sources"
			style="transform-xsl/build-location-sources.xsl"
			in="locations.xml"
			out="build-location-sources.xml">
		</style>
		<ant taskname="create-location-sources" antfile="build-location-sources.xml"/>

		<style
			taskname="build-order-sources"
			style="transform-xsl/build-order-sources.xsl"
			in="flat-species.xml"
			out="build-order-sources.xml">
		</style>
		<ant taskname="create-order-sources" antfile="build-order-sources.xml"/>
	
	</target>

	<!-- PRE-REQUISITES -->

	<target
		name="require-source"
		unless="source"
		description="ensure the user has defined a source for testing">

		<fail message="please define a page source on the command line"/>
	</target>

	<target
		name="require-kind"
		unless="kind"
		description="ensure the user has defined a report kind for testing">

		<fail message="please define a report kind on the command line"/>
	</target>

	<!-- DEBUGGING / DEVELOPMENT, SINGLE PAGE TARGETS -->

	<target
		name="build-index"
		depends="require-source, set-timestamp">

		<style
			taskname="test-index"
			style="report-xsl/indices.xsl"
			destdir="html"
			basedir="sources/indices"
			force="true">

			<param name="in-tstamp" expression="'${my.tstamp}'"/>
			<include name="${source}"/>
		</style>
	</target>

	<target
		name="build-report"
		if="source"
		depends="require-source, require-kind, set-timestamp">

		<style
			taskname="test-report"
			style="report-xsl/reports.xsl"
			destdir="html"
			basedir="sources/${kind}"
			force="true">

			<param name="in-tstamp" expression="'${my.tstamp}'"/>
			<include name="${source}"/>
		</style>
	</target>

	<!-- PRODUCTION TARGETS -->

	<target
		name="set-timestamp"
		description="Set the timestamp for marking HTML output files">

		<tstamp>
			<format property="my.tstamp" pattern="MM/dd/yyyy hh:mm aa"/>
		</tstamp>
	</target>

	<target
		name="build-indices"
		depends="set-timestamp">

		<style
			taskname="indices"
			style="report-xsl/indices.xsl"
			destdir="html"
			basedir="sources/indices">
			<param name="in-tstamp" expression="'${my.tstamp}'"/>
			<include name="*.xml"/>
		</style>
	</target>

	<target
		name="build-reports"
		depends="set-timestamp">

		<style
			taskname="year-reports"
			style="report-xsl/reports.xsl"
			destdir="html"
			basedir="sources/years">

			<param name="in-tstamp" expression="'${my.tstamp}'"/>
			<include name="*.xml"/>
		</style>

		<style
			taskname="order-reports"
			style="report-xsl/reports.xsl"
			destdir="html"
			basedir="sources/orders">

			<param name="in-tstamp" expression="'${my.tstamp}'"/>
			<include name="*.xml"/>
		</style>

		<style
			taskname="species-reports"
			style="report-xsl/reports.xsl"
			destdir="html"
			basedir="sources/species">

			<param name="in-tstamp" expression="'${my.tstamp}'"/>
			<include name="*.xml"/>
		</style>

		<style
			taskname="location-reports"
			style="report-xsl/reports.xsl"
			destdir="html"
			basedir="sources/locations">

			<param name="in-tstamp" expression="'${my.tstamp}'"/>
			<include name="*.xml"/>
		</style>

		<style
			taskname="trip-reports"
			style="report-xsl/reports.xsl"
			destdir="html"
			basedir="sources/trips">

			<param name="in-tstamp" expression="'${my.tstamp}'"/>
			<include name="*.xml"/>
		</style>
	</target>

	<target
		name="build-all"
		description="generate all the individual pages for species, locations, and trips"
		depends="build-sources, run-batch-transformer">
	</target>

	<target name="upload-to-shout">
		<ftp server="duracef.shout.net"
       		remotedir="public_html/birdwalker"
       		userid="walker"
       		password="ludwig0"
			passive="yes"
			verbose="yes"
       		depends="yes"
       		binary="no">
    		<fileset dir="html">
      			<include name="stylesheet.css"/>
    		</fileset>
  		</ftp>

		<ftp server="duracef.shout.net"
       		remotedir="public_html/birdwalker/images"
       		userid="walker"
       		password="ludwig0"
			passive="yes"
			verbose="yes"
       		depends="yes"
       		binary="no">
    		<fileset dir="html/images">
      			<include name="*.gif"/>
    		</fileset>
  		</ftp>

		<ftp server="duracef.shout.net"
       		remotedir="public_html/birdwalker"
       		userid="walker"
       		password="ludwig0"
			passive="yes"
			verbose="yes"
       		depends="yes"
       		binary="no">
    		<fileset dir="html">
      			<include name="**/*.html"/>
    		</fileset>
  		</ftp>
	</target>
</project>
